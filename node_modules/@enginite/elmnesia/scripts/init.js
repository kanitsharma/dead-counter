const fs = require('fs-extra');
const path = require('path');

module.exports = (appPath, dirName, verbose) => {
  const boilerplatePath = path.resolve(
    appPath,
    'node_modules',
    '@enginite',
    'elmnesia',
    'src',
  );

  console.log(
    'Copying boilerplate....',
    boilerplatePath,
    path.resolve(appPath, 'src'),
  );

  fs.copySync(boilerplatePath, path.resolve(appPath, 'src'));

  const rootPackagePath = path.resolve(
    appPath,
    'node_modules',
    '@enginite',
    'elmnesia',
  );

  [
    'elm-package.json',
    'elm.json',
    'main.js',
    'index.html',
    'webpack.config.js',
  ].forEach(file => {
    fs.copySync(
      path.resolve(rootPackagePath, file),
      path.resolve(appPath, file),
    );
  });

  fs.writeFileSync(
    path.resolve(appPath, '.gitignore'),
    'elm-stuff\nnode-modules\ndist',
  );

  fs.writeFileSync(
    path.join(appPath, 'package.json'),
    JSON.stringify(
      {
        name: dirName,
        scripts: {
          dev: 'NODE_ENV=development webpack-dev-server',
          build: 'NODE_ENV=production webpack',
        },
      },
      null,
      2,
    ),
  );
};
